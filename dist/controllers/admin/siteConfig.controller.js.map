{"version":3,"sources":["../../../controllers/admin/siteConfig.controller.js"],"names":["mysqlDetails","utils","getSiteConfig","req","res","next","pool","getConnection","err","connection","message","query","rows","json","data","release","updateSiteConfig","mandatoryFields","checkReqBody","checkMandatoryRequestBody","body","siteAdminID","values","theatreName","theatreURL","siteTimeZone","day","openTime","closeTime","siteConfigID","mysqlFormat","module","exports"],"mappings":"AAAA;;;AAGA;;AACA;;IAAYA,Y;;AACZ;;IAAYC,K;;;;AAEZ,IAAIC,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACpCL,iBAAaM,IAAb,CAAkBC,aAAlB,CAAgC,UAAUC,GAAV,EAAeC,UAAf,EAA2B;AACvD,YAAID,GAAJ,EAAS;AACLH,iBAAK;AACDK,yBAASF;AADR,aAAL;AAGH,SAJD,MAIO;AACHC,uBAAWE,KAAX,CAAiB,0CAAjB,EACI,CAAC,0BAAD,EAA6B,aAA7B,CADJ,EAEI,UAACH,GAAD,EAAMI,IAAN,EAAe;AACX,oBAAIJ,GAAJ,EAAS;AACLH,yBAAK;AACDK,iCAASF;AADR,qBAAL;AAGH,iBAJD,MAIO;AACHJ,wBAAIS,IAAJ,CAAS;AACLH,iCAAS,SADJ;AAELI,8BAAMF;AAFD,qBAAT;AAIH;AACJ,aAbL;AAcH;AACDH,mBAAWM,OAAX;AACH,KAtBD;AAuBH,CAxBD;;AA0BA;AACA,IAAIC,mBAAmB,SAAnBA,gBAAmB,CAACb,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvC;AACA,QAAIY,kBAAkB,CAAC,aAAD,EAClB,aADkB,EACH,YADG,EACW,cADX,EAC2B,KAD3B,EACkC,UADlC,EAC8C,WAD9C,CAAtB;AAEA,QAAIC,eAAejB,MAAMkB,yBAAN,CAAgChB,IAAIiB,IAApC,EAA0CH,eAA1C,CAAnB;AACA,QAAIC,aAAaR,OAAb,KAAyB,SAA7B,EAAwC;AACpC,eAAOL,KAAK,EAACK,SAASQ,aAAaR,OAAvB,EAAL,CAAP;AACH;;AAEDV,iBAAaM,IAAb,CAAkBC,aAAlB,CAAgC,UAAUC,GAAV,EAAeC,UAAf,EAA2B;AACvD,YAAID,GAAJ,EAAS;AACLH,iBAAK;AACDK,yBAASF;AADR,aAAL;AAGH,SAJD,MAIO;AACHL,gBAAIiB,IAAJ,CAASC,WAAT,GAAuB,UAAvB,CADG,CACgC;AACnC,gBAAIV,QAAQ,mBACR,8CADQ,GAER,gDAFQ,GAGR,wBAHJ;;AAKA,gBAAIW,SAAS,CAAC,0BAAD,EACTnB,IAAIiB,IAAJ,CAASC,WADA,EACalB,IAAIiB,IAAJ,CAASG,WADtB,EACmCpB,IAAIiB,IAAJ,CAASI,UAD5C,EAETrB,IAAIiB,IAAJ,CAASK,YAFA,EAEctB,IAAIiB,IAAJ,CAASM,GAFvB,EAE4BvB,IAAIiB,IAAJ,CAASO,QAFrC,EAGTxB,IAAIiB,IAAJ,CAASQ,SAHA,EAGW,gBAHX,EAG6BzB,IAAIiB,IAAJ,CAASS,YAHtC,EAIT1B,IAAIiB,IAAJ,CAASM,GAJA,CAAb;AAMAf,oBAAQX,aAAa8B,WAAb,CAAyBnB,KAAzB,EAAgCW,MAAhC,CAAR;AACAb,uBAAWE,KAAX,CAAiBA,KAAjB,EAAwB,UAACH,GAAD,EAAMI,IAAN,EAAe;AACnC,oBAAIJ,GAAJ,EAAS;AACLH,yBAAK;AACDK,iCAASF;AADR,qBAAL;AAGH,iBAJD,MAIO;AACHJ,wBAAIS,IAAJ,CAAS;AACLH,iCAAS;AADJ,qBAAT;AAGH;AACJ,aAVD;AAWH;AACDD,mBAAWM,OAAX;AACH,KAhCD;AAiCH,CA1CD;;AA6CAgB,OAAOC,OAAP,GAAiB;AACb9B,mBAAeA,aADF;AAEbc,sBAAkBA;AAFL,CAAjB","file":"siteConfig.controller.js","sourcesContent":["/**\n * Created by swapnil on 11/02/18.\n */\n'use strict';\nimport * as mysqlDetails from '../../database/connectMySQL';\nimport * as utils from '../../services/utils.service';\n\nlet getSiteConfig = (req, res, next) => {\n    mysqlDetails.pool.getConnection(function (err, connection) {\n        if (err) {\n            next({\n                message: err\n            });\n        } else {\n            connection.query('SELECT * from ?? where ?? = \\'userID_1\\'',\n                ['admin_site_configuration', 'siteAdminID'],\n                (err, rows) => {\n                    if (err) {\n                        next({\n                            message: err\n                        });\n                    } else {\n                        res.json({\n                            message: 'Success',\n                            data: rows\n                        });\n                    }\n                });\n        }\n        connection.release();\n    });\n};\n\n// Revisit this page required\nlet updateSiteConfig = (req, res, next) => {\n    // Check for mandatory fields\n    let mandatoryFields = ['siteAdminID',\n        'theatreName', 'theatreURL', 'siteTimeZone', 'day', 'openTime', 'closeTime'];\n    let checkReqBody = utils.checkMandatoryRequestBody(req.body, mandatoryFields);\n    if (checkReqBody.message !== 'success') {\n        return next({message: checkReqBody.message});\n    }\n\n    mysqlDetails.pool.getConnection(function (err, connection) {\n        if (err) {\n            next({\n                message: err\n            });\n        } else {\n            req.body.siteAdminID = 'userID_1'; // Needs to change\n            let query = 'UPDATE ?? SET ' +\n                'siteAdminID=?, theatreName=?, theatreURL=?, ' +\n                'siteTimeZone=?,day=?, openTime=?, closeTime=? ' +\n                'WHERE ?? = ? AND day=?';\n\n            let values = ['admin_site_configuration',\n                req.body.siteAdminID, req.body.theatreName, req.body.theatreURL,\n                req.body.siteTimeZone, req.body.day, req.body.openTime,\n                req.body.closeTime, 'site_config_ID', req.body.siteConfigID,\n                req.body.day\n            ];\n            query = mysqlDetails.mysqlFormat(query, values);\n            connection.query(query, (err, rows) => {\n                if (err) {\n                    next({\n                        message: err\n                    });\n                } else {\n                    res.json({\n                        message: 'Updated successfully'\n                    });\n                }\n            });\n        }\n        connection.release();\n    });\n};\n\n\nmodule.exports = {\n    getSiteConfig: getSiteConfig,\n    updateSiteConfig: updateSiteConfig\n};\n"]}