{"version":3,"sources":["../../../controllers/kidsInMind/search.controller.js"],"names":["reqPro","require","cheerio","searchMovies","req","res","next","url","params","movieName","then","htmlString","result","$","load","searchResults","find","i","length","temp","kimRating","movieKIMURL","attribs","href","children","idx","data","indexOf","substr","trim","push","json","message","catch","err","console","log","error","module","exports"],"mappings":"AAAA;;;AAGA;;AACA,IAAMA,SAASC,QAAQ,iBAAR,CAAf;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;;AAEA,IAAME,eAAe,SAAfA,YAAe,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACrC,QAAIC,wEACFH,IAAII,MAAJ,CAAWC,SADb;AAEAT,WAAOO,GAAP,EACKG,IADL,CACU,UAAUC,UAAV,EAAsB;AACxB,YAAIC,SAAS,EAAb;AACA,YAAMC,IAAIX,QAAQY,IAAR,CAAaH,UAAb,CAAV;AACA,YAAMI,gBAAgBF,EAAE,cAAF,EAAkBG,IAAlB,CAAuB,GAAvB,CAAtB;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,cAAcG,MAAlC,EAA0CD,GAA1C,EAA+C;AAC3C,gBAAIE,OAAO;AACPV,2BAAW,IADJ;AAEPW,2BAAW,IAFJ;AAGPC,6BAAaN,cAAcE,CAAd,EAAiBK,OAAjB,CAAyBC;AAH/B,aAAX;AAKA,gBAAIC,WAAWT,cAAcE,CAAd,EAAiBO,QAAhC;AACA,gBAAIC,MAAMD,SAAS,CAAT,EAAYE,IAAZ,CAAiBC,OAAjB,CAAyB,GAAzB,CAAV;AACA,gBAAIF,MAAM,CAAC,CAAX,EAAc;AACVN,qBAAKV,SAAL,GAAiBe,SAAS,CAAT,EAAYE,IAAZ,CAAiBE,MAAjB,CAAwB,CAAxB,EAA2BH,MAAM,CAAjC,CAAjB;AACAN,qBAAKV,SAAL,GAAiBU,KAAKV,SAAL,CAAeoB,IAAf,EAAjB;;AAEAV,qBAAKC,SAAL,GAAiBI,SAAS,CAAT,EAAYE,IAAZ,CAAiBE,MAAjB,CAAwBH,MAAM,CAA9B,EAAiCD,SAAS,CAAT,EAAYE,IAAZ,CAAiBR,MAAlD,CAAjB;AACAC,qBAAKC,SAAL,GAAiBD,KAAKC,SAAL,CAAeS,IAAf,EAAjB;AACAjB,uBAAOkB,IAAP,CAAYX,IAAZ;AACH;AACJ;AACDd,YAAI0B,IAAJ,CAAS;AACLC,qBAAS,SADJ;AAELN,kBAAMd;AAFD,SAAT;AAIH,KA1BL,EA2BKqB,KA3BL,CA2BW,UAAUC,GAAV,EAAe;AAClBC,gBAAQC,GAAR,CAAYF,GAAZ;AACA5B,aAAK,EAAC+B,OAAOH,GAAR,EAAL;AACH,KA9BL;AA+BH,CAlCD;;AAoCAI,OAAOC,OAAP,GAAiB;AACbpC,kBAAcA;AADD,CAAjB","file":"search.controller.js","sourcesContent":["/**\n * Created by swapnil on 19/02/18.\n */\n'use strict';\nconst reqPro = require('request-promise');\nconst cheerio = require('cheerio');\n\nconst searchMovies = (req, res, next) => {\n    let url = `http://www.kids-in-mind.com/cgi-bin/search/search.pl?q=\n    ${req.params.movieName}`;\n    reqPro(url)\n        .then(function (htmlString) {\n            let result = [];\n            const $ = cheerio.load(htmlString);\n            const searchResults = $('p[start=\"1\"]').find('a');\n            for (let i = 0; i < searchResults.length; i++) {\n                let temp = {\n                    movieName: null,\n                    kimRating: null,\n                    movieKIMURL: searchResults[i].attribs.href\n                };\n                let children = searchResults[i].children;\n                let idx = children[0].data.indexOf('[');\n                if (idx > -1) {\n                    temp.movieName = children[0].data.substr(0, idx - 1);\n                    temp.movieName = temp.movieName.trim();\n\n                    temp.kimRating = children[0].data.substr(idx - 1, children[0].data.length);\n                    temp.kimRating = temp.kimRating.trim();\n                    result.push(temp);\n                }\n            }\n            res.json({\n                message: 'success',\n                data: result\n            });\n        })\n        .catch(function (err) {\n            console.log(err);\n            next({error: err});\n        });\n};\n\nmodule.exports = {\n    searchMovies: searchMovies\n};\n"]}